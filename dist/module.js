define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react","rxjs"],((e,t,n,a,l,r)=>(()=>{"use strict";var o=[e=>{e.exports=l},e=>{e.exports=a},t=>{t.exports=e},,e=>{e.exports=t},e=>{e.exports=n},e=>{e.exports=r}],i={};function c(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return o[e](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{c.r(s),c.d(s,{plugin:()=>z});var e=c(4),t=c(5);function n(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e,t){n(this,"cmdbEndpoint",""),n(this,"grafanaEndpoint",""),this.cmdbEndpoint=e,this.grafanaEndpoint=t}getCloudElements(e){return fetch(`${this.cmdbEndpoint}/cloud-element/search?id=${e}`).then((e=>e.json()))}getMetricsList(e){return fetch(`${this.grafanaEndpoint}/api/datasources/aws-namespace/${e}`).then((e=>e.json()))}}const l={constant:6.5};var r=c(6);function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends t.DataSourceWithBackend{constructor(e){super(e),o(this,"service",void 0),this.service=new a(e.jsonData.cmdbEndpoint||"",e.jsonData.grafanaEndpoint||""),e.meta.jsonData=JSON.parse(JSON.stringify(e.jsonData))}findParam(e,t){t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]}getCloudElements(e){return(0,r.from)(this.service.getCloudElements(e).then((t=>{let n={};if(t&&t[0]){const a=t[0];n={elementType:a.elementType,elementId:parseInt(e,10),cloudIdentifierName:a.instanceName,cloudIdentifierId:a.instanceId,environmentId:parseInt(e,10)}}return n})))}getDefaultQuery(e){return l}query(e){const t=this.findParam("var-elementId",window.location.href);return t?this.getCloudElements(t).pipe((0,r.mergeMap)((t=>{let n=e.targets;for(let e=0;e<n.length;e++)n[e]=Object.assign({},n[e],t);return super.query(e)}))):super.query(e)}}var u=c(0),m=c.n(u),d=c(1);const p="metric",g="log",b="trace",v="api";let E;!function(e){e[e.Builder=0]="Builder",e[e.Code=1]="Code"}(E||(E={}));const h=[{label:"Metric",value:p},{label:"LOG",value:g},{label:"Trace",value:b},{label:"API",value:v}],f=[{label:"INFRA",value:"infra"},{label:"SERVICE",value:"service"}],y=[{label:"Maximum",value:"Maximum"},{label:"Minimum",value:"Minimum"},{label:"Sum",value:"Sum"},{label:"SampleCount",value:"SampleCount"},{label:"Average",value:"Average"}];E.Builder,E.Code;var I=c(2);const C=["children"];const O=e=>{let{children:t}=e,n=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,C);const a=(0,d.useStyles2)((0,u.useCallback)((e=>j(e,n)),[n]));return m().createElement("div",{className:a.root},t)},j=(e,t)=>{var n,a,l;return{root:(0,I.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(a=t.wrap)||void 0===a||a?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(l=t.gap)&&void 0!==l?l:2),flexGrow:t.flexGrow})}},x=e=>{let{label:t,collapsible:n,collapsed:a=!0,title:l,dataTestId:r,children:o}=e;const i=(0,d.useStyles2)(S),[c,s]=(0,u.useState)(a),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-row${e?"-"+e:""}-${(r||t).replace(/\ /g,"-")}`.toLowerCase()};return m().createElement("div",{className:i.root,"data-testid":p("wrapper")},n&&m().createElement(m().Fragment,null,m().createElement(d.Button,{icon:c?"angle-down":"angle-right",fill:"text",size:"sm",variant:"secondary",onClick:e=>{s(!c),e.preventDefault()},style:{marginRight:"10px"},"data-testid":p("collapse-"+(c?"hide":"show"))}),m().createElement("span",{onClick:e=>{s(!c),e.preventDefault()},"data-testid":p("title")},m().createElement("b",{className:i.collapseTile},t)),m().createElement("span",{className:i.collapseTileSecondary},l?l():"Options")),c&&m().createElement("div",{style:{display:"flex",marginTop:t&&n?"15px":"0px",marginLeft:"0px"},"data-testid":p("children")},o))},S=e=>({root:(0,I.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)}),collapseTile:(0,I.css)({marginRight:e.spacing(1),color:e.colors.secondary.text}),collapseTileSecondary:(0,I.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.secondary.text}})}),w=e=>{let{children:t}=e;return m().createElement(O,{gap:.5,direction:"column"},t)};function T(e){let{query:t,onChange:n,editorMode:a,metricsList:l}=e;const{elementType:r,cloudIdentifierId:o,metricName:i,statistic:c,metricQuery:s}=t;return m().createElement(w,null,m().createElement(x,{label:""},m().createElement(d.InlineField,{label:"Element Type"},m().createElement(d.Input,{value:r,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Instance ID"},m().createElement(d.Input,{value:o,onChange:e=>(e=>{n(Object.assign({},t,{cloudIdentifierId:e.target.value}))})(e)}))),a===E.Builder?m().createElement(x,{label:""},m().createElement(d.InlineField,{label:"Metric Name"},m().createElement(d.Select,{className:"min-width-12 width-12",value:i,options:l,onChange:e=>{return a=e.value,void n(Object.assign({},t,{metricName:a}));var a},menuShouldPortal:!0})),m().createElement(d.InlineField,{label:"Statistic"},m().createElement(d.Select,{className:"min-width-12 width-12",value:c,options:y,onChange:e=>{return a=e.value,void n(Object.assign({},t,{statistic:a}));var a},menuShouldPortal:!0}))):m().createElement(x,{label:""},m().createElement(d.Input,{placeholder:"Enter your query",value:s,onChange:e=>(e=>{n(Object.assign({},t,{metricQuery:e.target.value}))})(e)})))}function F(e){let{query:t,onChange:n}=e;const{elementType:a,instanceID:l,logQuery:r,logGroup:o}=t;return m().createElement(w,null,m().createElement(x,{label:""},m().createElement(d.InlineField,{label:"Element Type"},m().createElement(d.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Instance ID"},m().createElement(d.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Log Group"},m().createElement(d.Input,{value:o,onChange:e=>(e=>{n(Object.assign({},t,{logGroup:e.target.value}))})(e)}))),m().createElement(x,{label:""},m().createElement(d.Input,{placeholder:"Enter your log query",value:r,onChange:e=>(e=>{n(Object.assign({},t,{logQuery:e.target.value}))})(e)})))}function N(e){let{query:t,onChange:n}=e;const{elementType:a,instanceID:l,traceQuery:r,traceLocation:o}=t;return m().createElement(w,null,m().createElement(x,{label:""},m().createElement(d.InlineField,{label:"Element Type"},m().createElement(d.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Instance ID"},m().createElement(d.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Trace Location"},m().createElement(d.Input,{value:o,onChange:e=>(e=>{n(Object.assign({},t,{traceLocation:e.target.value}))})(e)}))),m().createElement(x,{label:""},m().createElement(d.Input,{placeholder:"Enter your trace query",value:r,onChange:e=>(e=>{n(Object.assign({},t,{traceQuery:e.target.value}))})(e)})))}const D=e=>{const t=(0,d.useTheme2)(),n=R(t,e);return m().createElement("span",{className:(0,I.cx)(n.wrapper)})};D.defaultProps={v:0,h:0,layout:"block"};const R=(0,d.stylesFactory)(((e,t)=>{var n,a;return{wrapper:(0,I.css)([{paddingRight:e.spacing(null!==(n=t.h)&&void 0!==n?n:0),paddingBottom:e.spacing(null!==(a=t.v)&&void 0!==a?a:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}}));var P;const k=["label","optional","tooltip","children","promoNode","width","invalid","borderColor","tag","dataTestId","horizontal"];function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},q.apply(this,arguments)}const M=e=>{const{label:t,optional:n,tooltip:a,children:l,promoNode:r,width:o,invalid:i,borderColor:c,tag:s,dataTestId:u,horizontal:p}=e,g=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,k),b=(0,d.useTheme2)(),v=L(b,o,i?"red":c,p),E=(null==g?void 0:g.htmlFor)||(null===d.ReactUtils||void 0===d.ReactUtils?void 0:d.ReactUtils.getChildId(l)),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-field${e?"-"+e:""}-${(u||t).replace(/\ /g,"-")}`.toLowerCase()},f=m().createElement(m().Fragment,null,m().createElement("label",{className:v.label,htmlFor:E,"data-testid":h("label")},t,s&&m().createElement(d.Tag,{name:s,className:v.tag,colorIndex:10}),n&&m().createElement("span",{className:v.optional}," - optional"),r,a&&m().createElement(d.Tooltip,{placement:"top",content:a,theme:"info"},m().createElement(d.Icon,{name:"info-circle",size:"sm",className:v.icon}))),P||(P=m().createElement(D,{v:.5})));return p?m().createElement("div",{className:v.root,"data-testid":h("wrapper")},m().createElement(d.Field,q({className:v.field,label:f},g,{horizontal:!0}),l)):m().createElement("div",{className:v.root,"data-testid":h("wrapper")},m().createElement(d.Field,q({className:v.field,label:f},g),l))},L=(0,d.stylesFactory)((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transparent",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{root:(0,I.css)({minWidth:e.spacing(null!=t?t:0),paddingInlineStart:"7px",paddingInlineEnd:"5px",borderLeft:`1px solid ${n}`,marginRight:a?"10px":"5px"}),label:(0,I.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium,paddingLeft:"1px",border:a?`1px solid ${n}`:"",padding:a?"5px 10px 5px 0px":"",textAlign:a?"right":"left"}),tag:(0,I.css)({marginLeft:"10px"}),optional:(0,I.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,I.css)({marginBottom:0,marginRight:"0px"}),icon:(0,I.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}}));var A,B,Q;function $(e){let{query:t,onChange:n}=e;const{elementType:a,instanceID:l,method:r,columns:o,isObjectInsteadOfArray:i,isDataInColumn:c,rowsRoots:s}=t,[p,g]=m().useState([]),b=(0,u.useRef)(!1);m().useEffect((()=>{!1===b.current&&g(o||[{selector:"",as:"",formatAs:""}]),b.current=!0}),[o]);const v=(e,a,l,r)=>{a[e][l]=r,n(Object.assign({},t,{columns:JSON.parse(JSON.stringify(a))}))},E=(e,t)=>{e.splice(t,1),g(JSON.parse(JSON.stringify(e)))};return m().createElement(w,null,m().createElement(x,{label:""},m().createElement(d.InlineField,{label:"Element Type"},m().createElement(d.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Instance ID"},m().createElement(d.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),m().createElement(d.InlineField,{label:"Method"},m().createElement(d.Input,{value:r,onChange:e=>(e=>{n(Object.assign({},t,{method:e.target.value}))})(e)}))),A||(A=m().createElement(x,{label:""},m().createElement("h5",null,m().createElement("b",null,"Parsing Option and Result Field")))),m().createElement(x,{label:""},m().createElement(M,{label:"Rows/Root - Optional"},m().createElement("textarea",{value:s,onChange:e=>{n(Object.assign({},t,{rowsRoots:e.target.value}))},placeholder:"Rows/Root Selector"}))),B||(B=m().createElement(x,{label:""},m().createElement("label",null,"Rows/Root - Optional"))),(e=>{const t=[];for(let n=0;n<e.length;n++){const a=e[n];t.push(m().createElement(x,{label:"",key:`column-${n}`},m().createElement(d.InlineField,{label:"Selector"},m().createElement(d.Input,{value:a.selector,onChange:t=>v(n,e,"selector",t.target.value)})),m().createElement(d.InlineField,{label:"as"},m().createElement(d.Input,{value:a.as,onChange:t=>v(n,e,"as",t.target.value)})),m().createElement(d.InlineField,{label:"Format as"},m().createElement(d.Input,{value:a.formatAs,onChange:t=>v(n,e,"formatAs",t.target.value)})),e.length>1?m().createElement(d.Button,{onClick:()=>E(e,n),icon:"times"}):m().createElement(m().Fragment,null)))}return t})(p),m().createElement(x,{label:"Column - Optional"},m().createElement(d.Button,{onClick:()=>{p.push({selector:"",as:"",formatAs:""}),g(JSON.parse(JSON.stringify(p)))},icon:"plus-square"},"Column")),Q||(Q=m().createElement(x,{label:""},m().createElement("label",null,"Advance Options - Optional"))),m().createElement(x,{label:""},m().createElement(d.Checkbox,{value:i,label:"Root returns object instead of array?",onChange:e=>{n(Object.assign({},t,{isObjectInsteadOfArray:e.target.checked}))}})),m().createElement(x,{label:""},m().createElement(d.Checkbox,{value:c,label:"Is data in column format?",onChange:e=>{n(Object.assign({},t,{isDataInColumn:e.target.checked}))}})))}const z=new e.DataSourcePlugin(i).setConfigEditor((function(e){const{onOptionsChange:t,options:n}=e,{jsonData:a}=n;return m().createElement("div",{className:"gf-form-group"},m().createElement(d.InlineField,{label:"Grafana Endpoint",labelWidth:24},m().createElement(d.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{grafanaEndpoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.grafanaEndpoint||"",placeholder:"http://localhost:3001",width:40})),m().createElement(d.InlineField,{label:"CMDB API Endpoint",labelWidth:24},m().createElement(d.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{cmdbEndpoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.cmdbEndpoint||"",placeholder:"https://api.synectiks.net/cmdb",width:40})))})).setQueryEditor((function(e){let{query:t,onChange:n,onRunQuery:l,datasource:r}=e;const o=new a(r.meta.jsonData.cmdbEndpoint||"",r.meta.jsonData.grafanaEndpoint||""),[i,c]=(0,u.useState)(""),[s,y]=(0,u.useState)([]),I=(0,u.useRef)(!1),C=(0,u.useCallback)(((e,t)=>{o.getCloudElements(e).then((a=>{if(a&&a[0]){const l=a[0];t=Object.assign({},t,{elementType:l.elementType,elementId:parseInt(e,10),cloudIdentifierName:l.instanceName,cloudIdentifierId:l.instanceId,type:"appkube-metrics",queryMode:"Metrics",source:"url",productId:1,environmentId:parseInt(e,10),moduleId:2,serviceId:2,serviceType:"java app service",cmdbUrl:"",vaultUrl:"",namespace:l.elementType,matchExact:!0,expression:"",id:"",alias:"",period:"",metricQueryType:0,metricEditorMode:0,sqlExpression:"",accountId:"657907747545",region:""}),n(Object.assign({},t)),o.getMetricsList(a[0].elementType).then((e=>{y(e)}))}}))}),[n]);(0,u.useEffect)((()=>{if(!1===I.current){const e=O("var-elementId",window.location.href);e?(c(e),C(e,t)):alert("Please set 'elementId' variable"),I.current=!0}}),[t,n,C]);const O=(e,t)=>{t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]},j=e=>{n(Object.assign({},t,e))},{sourceType:x,metricType:S,metricEditorMode:w}=t,D=w||E.Builder;return m().createElement("div",null,m().createElement("div",{style:{display:"flex",alignItems:"center"}},m().createElement(d.InlineField,{label:"Source Type"},m().createElement(d.Select,{className:"min-width-12 width-12",value:x,options:h,onChange:e=>(e=>{if(e===p?t.queryType="timeSeriesQuery":e===g&&(t.queryType="logAction"),t.sourceType=e,i)C(i,t);else{const e=O("var-elementId",window.location.href);e?(c(e),C(e,t)):alert("Please set 'elementId' variable")}})(e.value),menuShouldPortal:!0})),x===p?m().createElement(m().Fragment,null,m().createElement(d.InlineField,{label:"Source Type"},m().createElement(d.Select,{className:"min-width-12 width-12",value:S,options:f,onChange:e=>{return a=e.value,void n(Object.assign({},t,{metricType:a}));var a},menuShouldPortal:!0})),m().createElement(d.InlineField,{label:"Element ID"},m().createElement(d.Input,{disabled:!0,value:i})),m().createElement("div",{style:{display:"block",flexGrow:"1"}})):m().createElement(m().Fragment,null)),m().createElement("div",null,x===p?m().createElement(T,{query:t,onChange:j,editorMode:D,metricsList:s}):m().createElement(m().Fragment,null),x===g?m().createElement(F,{query:t,onChange:j}):m().createElement(m().Fragment,null),x===b?m().createElement(N,{query:t,onChange:j}):m().createElement(m().Fragment,null),x===v?m().createElement($,{query:t,onChange:j}):m().createElement(m().Fragment,null)))}))})(),s})()));
//# sourceMappingURL=module.js.map