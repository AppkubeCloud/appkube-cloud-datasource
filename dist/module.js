define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react","rxjs"],((e,t,n,a,l,r)=>(()=>{"use strict";var o=[e=>{e.exports=l},e=>{e.exports=a},t=>{t.exports=e},,e=>{e.exports=t},e=>{e.exports=n},e=>{e.exports=r}],i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return o[e](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{s.r(c),s.d(c,{plugin:()=>S});var e=s(4),t=s(5);function n(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e,t){n(this,"cmdbEndpoint",""),n(this,"grafanaEndpoint",""),this.cmdbEndpoint=e,this.grafanaEndpoint=t}getCloudElements(e){return fetch(`${this.cmdbEndpoint}/cloud-element/search?id=${e}`).then((e=>e.json()))}getSupportedPanels(e,t){return fetch(`${this.cmdbEndpoint}/cloud-element-supported-api/search?elementType=${e}&cloud=${t}`).then((e=>e.json()))}}const l={constant:6.5};let r;!function(e){e[e.Builder=0]="Builder",e[e.Code=1]="Code"}(r||(r={}));const o=[{label:"JSON",value:"JSON"},{label:"Frame",value:"Frame"}],i=(r.Builder,r.Code,function(e,t,n){return{cloudIdentifierName:t.instanceName,type:"appkube-api",queryMode:"Metrics",matchExact:!0,expression:"",id:"",alias:"",period:"",zone:"",externalId:"",crossAccountRoleArn:"",elementType:t.elementType,elementId:parseInt(e,10),cloudIdentifierId:t.instanceId,awsxUrl:n,logGroupName:t.logGroup}});var d=s(6);function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m extends t.DataSourceWithBackend{constructor(e){super(e),u(this,"service",void 0),u(this,"awsxUrl",void 0),this.service=new a(e.jsonData.cmdbEndpoint||"",e.jsonData.grafanaEndpoint||""),e.meta.jsonData=JSON.parse(JSON.stringify(e.jsonData)),this.awsxUrl=e.jsonData.awsxEndPoint||""}getCloudElements(e){return(0,d.from)(this.service.getCloudElements(e).then((t=>{let n={};if(t&&t[0]){const a=t[0];a&&(n=i(e,a,this.awsxUrl))}return n})))}getDefaultQuery(e){return l}query(e){let t="";var n;if(document.getElementById("elementId"))t=null===(n=document.getElementById("elementId"))||void 0===n?void 0:n.value;else if(document.getElementById("var-elementId")){var a;t=null===(a=document.getElementById("var-elementId"))||void 0===a?void 0:a.value}return t?this.getCloudElements(t).pipe((0,d.mergeMap)((t=>{let n=e.targets;for(let e=0;e<n.length;e++)n[e]=Object.assign({},n[e],t);return super.query(e)}))):super.query(e)}}var p=s(0),g=s.n(p),v=s(1);var f=s(2);const b=["children"];const h=e=>{let{children:t}=e,n=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,b);const a=(0,v.useStyles2)((0,p.useCallback)((e=>y(e,n)),[n]));return g().createElement("div",{className:a.root},t)},y=(e,t)=>{var n,a,l;return{root:(0,f.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(a=t.wrap)||void 0===a||a?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(l=t.gap)&&void 0!==l?l:2),flexGrow:t.flexGrow})}},E=e=>{let{label:t,collapsible:n,collapsed:a=!0,title:l,dataTestId:r,children:o}=e;const i=(0,v.useStyles2)(I),[s,c]=(0,p.useState)(a),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-row${e?"-"+e:""}-${(r||t).replace(/\ /g,"-")}`.toLowerCase()};return g().createElement("div",{className:i.root,"data-testid":d("wrapper")},n&&g().createElement(g().Fragment,null,g().createElement(v.Button,{icon:s?"angle-down":"angle-right",fill:"text",size:"sm",variant:"secondary",onClick:e=>{c(!s),e.preventDefault()},style:{marginRight:"10px"},"data-testid":d("collapse-"+(s?"hide":"show"))}),g().createElement("span",{onClick:e=>{c(!s),e.preventDefault()},"data-testid":d("title")},g().createElement("b",{className:i.collapseTile},t)),g().createElement("span",{className:i.collapseTileSecondary},l?l():"Options")),s&&g().createElement("div",{style:{display:"flex",marginTop:t&&n?"15px":"0px",marginLeft:"0px"},"data-testid":d("children")},o))},I=e=>({root:(0,f.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)}),collapseTile:(0,f.css)({marginRight:e.spacing(1),color:e.colors.secondary.text}),collapseTileSecondary:(0,f.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.secondary.text}})}),j=e=>{let{children:t}=e;return g().createElement(h,{gap:.5,direction:"column"},t)};const S=new e.DataSourcePlugin(m).setConfigEditor((function(e){const{onOptionsChange:t,options:n}=e,{jsonData:a}=n;return g().createElement("div",{className:"gf-form-group"},g().createElement(v.InlineField,{label:"Grafana Endpoint",labelWidth:24},g().createElement(v.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{grafanaEndpoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.grafanaEndpoint||"",placeholder:"http://localhost:3001",width:40})),g().createElement(v.InlineField,{label:"CMDB API Endpoint",labelWidth:24},g().createElement(v.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{cmdbEndpoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.cmdbEndpoint||"",placeholder:"https://api.synectiks.net/cmdb",width:40})),g().createElement(v.InlineField,{label:"AWSX API Endpoint",labelWidth:24},g().createElement(v.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{awsxEndPoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.awsxEndPoint||"",placeholder:"https://api.synectiks.net/cmdb",width:40})))})).setQueryEditor((function(e){let{query:t,onChange:n,onRunQuery:l,datasource:r}=e;const s=[{label:"All",value:""}],c=new a(r.meta.jsonData.cmdbEndpoint||"",r.meta.jsonData.grafanaEndpoint||""),[d,u]=(0,p.useState)(""),[m,f]=(0,p.useState)([]),[b,h]=(0,p.useState)({}),[y,I]=(0,p.useState)(s),S=(0,p.useRef)(!1),x=(0,p.useCallback)(((e,t)=>{c.getCloudElements(e).then((a=>{if(a&&a[0]){const l=a[0];if(l){const a=i(e,l,r.meta.jsonData.awsxEndPoint||"");t=Object.assign({},t,a),n(Object.assign({},t)),c.getSupportedPanels(l.elementType.toUpperCase(),"AWS").then((e=>{if(e&&e.length>0){const n=[],a={};e.map((e=>{n.push({label:e.name,value:e.name}),a[e.name]=e.frames})),f(n),h(a);const{queryString:l}=t,r=a[l];if(r){const e=r.split(",").map((e=>({label:e,value:e})));I([...s,...e])}else I([...s])}}))}}}))}),[n]);(0,p.useEffect)((()=>{if(!1===S.current){let a="";var e;if(document.getElementById("elementId"))a=null===(e=document.getElementById("elementId"))||void 0===e?void 0:e.value;else if(document.getElementById("var-elementId")){var n;a=null===(n=document.getElementById("var-elementId"))||void 0===n?void 0:n.value}else a=t.elementId;a?(u(a),x(a,t)):alert("Please set 'elementId' variable"),S.current=!0}}),[t,n,x]);const{elementType:w,cloudIdentifierId:O,queryString:C,responseType:D,selectedFrame:P}=t;return g().createElement("div",null,g().createElement(j,null,g().createElement(E,{label:""},g().createElement(v.InlineField,{label:"Element Type"},g().createElement(v.Input,{value:w,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),g().createElement(v.InlineField,{label:"Instance ID"},g().createElement(v.Input,{value:O,onChange:e=>(e=>{n(Object.assign({},t,{cloudIdentifierId:e.target.value}))})(e)})),g().createElement(v.InlineField,{label:"Element ID"},g().createElement(v.Input,{disabled:!0,value:d})))),g().createElement(j,null,g().createElement(E,{label:""},g().createElement(v.InlineField,{label:"Supported Panels"},g().createElement(v.Select,{className:"min-width-12 width-12",value:C,options:m,onChange:e=>(e=>{n(Object.assign({},t,{queryString:e}));const a=b[e];if(a){const e=a.split(",").map((e=>({label:e,value:e})));I([...s,...e])}else I([...s])})(e.value),menuShouldPortal:!0})),g().createElement(v.InlineField,{label:"Response Type"},g().createElement(v.Select,{className:"min-width-12 width-12",value:D,options:o,onChange:e=>{return a=e.value,void n(Object.assign({},t,{responseType:a}));var a},menuShouldPortal:!0})),g().createElement(v.InlineField,{label:"Frames"},g().createElement(v.Select,{className:"min-width-12 width-12",value:P,options:y,onChange:e=>{return a=e.value,void n(Object.assign({},t,{selectedFrame:a}));var a},menuShouldPortal:!0})))))}))})(),c})()));
//# sourceMappingURL=module.js.map