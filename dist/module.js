define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react","rxjs"],((e,t,n,a,r,l)=>(()=>{"use strict";var o=[e=>{e.exports=r},e=>{e.exports=a},t=>{t.exports=e},,e=>{e.exports=t},e=>{e.exports=n},e=>{e.exports=l}],i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return o[e](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{s.r(c),s.d(c,{plugin:()=>j});var e=s(4),t=s(5);function n(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e,t){n(this,"cmdbEndpoint",""),n(this,"grafanaEndpoint",""),this.cmdbEndpoint=e,this.grafanaEndpoint=t}getCloudElements(e){return fetch(`${this.cmdbEndpoint}/cloud-element/search?id=${e}`).then((e=>e.json()))}getSupportedPanels(e){return fetch(`${this.cmdbEndpoint}/api/datasources/aws-namespace/${e}`).then((e=>e.json()))}}const r={constant:6.5};var l=s(6);function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends t.DataSourceWithBackend{constructor(e){super(e),o(this,"service",void 0),this.service=new a(e.jsonData.cmdbEndpoint||"",e.jsonData.grafanaEndpoint||""),e.meta.jsonData=JSON.parse(JSON.stringify(e.jsonData))}findParam(e,t){t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]}getCloudElements(e){return(0,l.from)(this.service.getCloudElements(e).then((t=>{let n={};if(t&&t[0]){const a=t[0];n={elementType:a.elementType,elementId:parseInt(e,10),cloudIdentifierName:a.instanceName,cloudIdentifierId:a.instanceId,environmentId:parseInt(e,10)}}return n})))}getDefaultQuery(e){return r}query(e){const t=this.findParam("var-elementId",window.location.href);return t?this.getCloudElements(t).pipe((0,l.mergeMap)((t=>{let n=e.targets;for(let e=0;e<n.length;e++)n[e]=Object.assign({},n[e],t);return super.query(e)}))):super.query(e)}}var d=s(0),u=s.n(d),p=s(1);let m;!function(e){e[e.Builder=0]="Builder",e[e.Code=1]="Code"}(m||(m={}));const g=[{label:"JSON",value:"JSON"},{label:"Frame",value:"Frame"}];m.Builder,m.Code;var f=s(2);const v=["children"];const b=e=>{let{children:t}=e,n=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,v);const a=(0,p.useStyles2)((0,d.useCallback)((e=>h(e,n)),[n]));return u().createElement("div",{className:a.root},t)},h=(e,t)=>{var n,a,r;return{root:(0,f.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(a=t.wrap)||void 0===a||a?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(r=t.gap)&&void 0!==r?r:2),flexGrow:t.flexGrow})}},y=e=>{let{label:t,collapsible:n,collapsed:a=!0,title:r,dataTestId:l,children:o}=e;const i=(0,p.useStyles2)(E),[s,c]=(0,d.useState)(a),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-row${e?"-"+e:""}-${(l||t).replace(/\ /g,"-")}`.toLowerCase()};return u().createElement("div",{className:i.root,"data-testid":m("wrapper")},n&&u().createElement(u().Fragment,null,u().createElement(p.Button,{icon:s?"angle-down":"angle-right",fill:"text",size:"sm",variant:"secondary",onClick:e=>{c(!s),e.preventDefault()},style:{marginRight:"10px"},"data-testid":m("collapse-"+(s?"hide":"show"))}),u().createElement("span",{onClick:e=>{c(!s),e.preventDefault()},"data-testid":m("title")},u().createElement("b",{className:i.collapseTile},t)),u().createElement("span",{className:i.collapseTileSecondary},r?r():"Options")),s&&u().createElement("div",{style:{display:"flex",marginTop:t&&n?"15px":"0px",marginLeft:"0px"},"data-testid":m("children")},o))},E=e=>({root:(0,f.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)}),collapseTile:(0,f.css)({marginRight:e.spacing(1),color:e.colors.secondary.text}),collapseTileSecondary:(0,f.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.secondary.text}})}),I=e=>{let{children:t}=e;return u().createElement(b,{gap:.5,direction:"column"},t)};const j=new e.DataSourcePlugin(i).setConfigEditor((function(e){const{onOptionsChange:t,options:n}=e,{jsonData:a}=n;return u().createElement("div",{className:"gf-form-group"},u().createElement(p.InlineField,{label:"Grafana Endpoint",labelWidth:24},u().createElement(p.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{grafanaEndpoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.grafanaEndpoint||"",placeholder:"http://localhost:3001",width:40})),u().createElement(p.InlineField,{label:"CMDB API Endpoint",labelWidth:24},u().createElement(p.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{cmdbEndpoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.cmdbEndpoint||"",placeholder:"https://api.synectiks.net/cmdb",width:40})),u().createElement(p.InlineField,{label:"AWSX API Endpoint",labelWidth:24},u().createElement(p.Input,{onChange:e=>{const a=Object.assign({},n.jsonData,{awsxEndPoint:e.target.value});t(Object.assign({},n,{jsonData:a}))},value:a.awsxEndPoint||"",placeholder:"https://api.synectiks.net/cmdb",width:40})))})).setQueryEditor((function(e){let{query:t,onChange:n,onRunQuery:r,datasource:l}=e;const o=new a(l.meta.jsonData.cmdbEndpoint||"",l.meta.jsonData.grafanaEndpoint||""),[i,s]=(0,d.useState)(""),[c,m]=(0,d.useState)([]),f=(0,d.useRef)(!1),v=(0,d.useCallback)(((e,t)=>{o.getCloudElements(e).then((a=>{if(a&&a[0]){const r=a[0];t=Object.assign({},t,{elementType:r.elementType,elementId:parseInt(e,10),cloudIdentifierName:r.instanceName,cloudIdentifierId:r.instanceId,type:"appkube-metrics",queryMode:"Metrics",source:"url",productId:1,environmentId:parseInt(e,10),moduleId:2,serviceId:2,serviceType:"java app service",cmdbUrl:"",vaultUrl:"",namespace:r.elementType,matchExact:!0,expression:"",id:"",alias:"",period:"",metricQueryType:0,metricEditorMode:0,sqlExpression:"",accountId:"657907747545",region:""}),n(Object.assign({},t)),o.getSupportedPanels(a[0].elementType).then((e=>{m(e)}))}}))}),[n]);(0,d.useEffect)((()=>{if(!1===f.current){const e=b("var-elementId",window.location.href);e?(s(e),v(e,t)):alert("Please set 'elementId' variable"),f.current=!0}}),[t,n,v]);const b=(e,t)=>{t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]},{elementType:h,cloudIdentifierId:E,supportedPanel:j,responseType:w}=t;return u().createElement("div",null,u().createElement(I,null,u().createElement(y,{label:""},u().createElement(p.InlineField,{label:"Element Type"},u().createElement(p.Input,{value:h,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),u().createElement(p.InlineField,{label:"Instance ID"},u().createElement(p.Input,{value:E,onChange:e=>(e=>{n(Object.assign({},t,{cloudIdentifierId:e.target.value}))})(e)})),u().createElement(p.InlineField,{label:"Element ID"},u().createElement(p.Input,{disabled:!0,value:i})))),u().createElement(I,null,u().createElement(y,{label:""},u().createElement(p.InlineField,{label:"Supported Panels"},u().createElement(p.Select,{className:"min-width-12 width-12",value:j,options:c,onChange:e=>{return a=e.value,void n(Object.assign({},t,{supportedPanel:a}));var a},menuShouldPortal:!0})),u().createElement(p.InlineField,{label:"Response Type"},u().createElement(p.Select,{className:"min-width-12 width-12",value:w,options:g,onChange:e=>{return a=e.value,void n(Object.assign({},t,{supportedPanel:a}));var a},menuShouldPortal:!0})))))}))})(),c})()));
//# sourceMappingURL=module.js.map