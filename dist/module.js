define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react"],((e,t,l,n,a)=>(()=>{"use strict";var r=[e=>{e.exports=a},e=>{e.exports=n},t=>{t.exports=e},,e=>{e.exports=t},e=>{e.exports=l}],o={};function c(e){var t=o[e];if(void 0!==t)return t.exports;var l=o[e]={exports:{}};return r[e](l,l.exports,c),l.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var l in t)c.o(t,l)&&!c.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{c.r(i),c.d(i,{plugin:()=>Q});var e=c(4),t=c(5);const l={constant:6.5};class n extends t.DataSourceWithBackend{constructor(e){super(e)}getDefaultQuery(e){return l}query(e){return super.query(e)}}var a=c(0),r=c.n(a),o=c(1);const s="metric",u="log",d="trace",m="api";let p;!function(e){e[e.Builder=0]="Builder",e[e.Code=1]="Code"}(p||(p={}));const g=[{label:"Metric",value:s},{label:"LOG",value:u},{label:"Trace",value:d},{label:"API",value:m}],E=[{label:"INFRA",value:"infra"},{label:"SERVICE",value:"service"}],b=[{label:"Metric 1",value:"Metric 1"},{label:"Metric 2",value:"Metric 2"},{label:"Metric 3",value:"Metric 3"}],v=[{label:"Stastic 1",value:"Stastic 1"},{label:"Stastic 2",value:"Stastic 2"},{label:"Stastic 3",value:"Stastic 3"}];p.Builder,p.Code;var h=c(2);const y=["children"];const f=e=>{let{children:t}=e,l=function(e,t){if(null==e)return{};var l,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)l=r[n],t.indexOf(l)>=0||(a[l]=e[l]);return a}(e,y);const n=(0,o.useStyles2)((0,a.useCallback)((e=>I(e,l)),[l]));return r().createElement("div",{className:n.root},t)},I=(e,t)=>{var l,n,a;return{root:(0,h.css)({display:"flex",flexDirection:null!==(l=t.direction)&&void 0!==l?l:"row",flexWrap:null===(n=t.wrap)||void 0===n||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(a=t.gap)&&void 0!==a?a:2),flexGrow:t.flexGrow})}},C=e=>{let{label:t,collapsible:l,collapsed:n=!0,title:c,dataTestId:i,children:s}=e;const u=(0,o.useStyles2)(O),[d,m]=(0,a.useState)(n),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-row${e?"-"+e:""}-${(i||t).replace(/\ /g,"-")}`.toLowerCase()};return r().createElement("div",{className:u.root,"data-testid":p("wrapper")},l&&r().createElement(r().Fragment,null,r().createElement(o.Button,{icon:d?"angle-down":"angle-right",fill:"text",size:"sm",variant:"secondary",onClick:e=>{m(!d),e.preventDefault()},style:{marginRight:"10px"},"data-testid":p("collapse-"+(d?"hide":"show"))}),r().createElement("span",{onClick:e=>{m(!d),e.preventDefault()},"data-testid":p("title")},r().createElement("b",{className:u.collapseTile},t)),r().createElement("span",{className:u.collapseTileSecondary},c?c():"Options")),d&&r().createElement("div",{style:{display:"flex",marginTop:t&&l?"15px":"0px",marginLeft:"0px"},"data-testid":p("children")},s))},O=e=>({root:(0,h.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)}),collapseTile:(0,h.css)({marginRight:e.spacing(1),color:e.colors.secondary.text}),collapseTileSecondary:(0,h.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.secondary.text}})}),x=e=>{let{children:t}=e;return r().createElement(f,{gap:.5,direction:"column"},t)};function j(e){let{query:t,onChange:l,editorMode:n}=e;const{elementType:a,cloudIdentifierId:c,MetricName:i,statistic:s,metricQuery:u}=t;return r().createElement(x,null,r().createElement(C,{label:""},r().createElement(o.InlineField,{label:"Element Type"},r().createElement(o.Input,{value:a,onChange:e=>(e=>{l(Object.assign({},t,{elementType:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Instance ID"},r().createElement(o.Input,{value:c,onChange:e=>(e=>{l(Object.assign({},t,{cloudIdentifierId:e.target.value}))})(e)}))),n===p.Builder?r().createElement(C,{label:""},r().createElement(o.InlineField,{label:"Metric Name"},r().createElement(o.Select,{className:"min-width-12 width-12",value:i,options:b,onChange:e=>{return n=e.value,void l(Object.assign({},t,{MetricName:n}));var n},menuShouldPortal:!0})),r().createElement(o.InlineField,{label:"Statistic"},r().createElement(o.Select,{className:"min-width-12 width-12",value:s,options:v,onChange:e=>{return n=e.value,void l(Object.assign({},t,{statistic:n}));var n},menuShouldPortal:!0}))):r().createElement(C,{label:""},r().createElement(o.Input,{placeholder:"Enter your query",value:u,onChange:e=>(e=>{l(Object.assign({},t,{metricQuery:e.target.value}))})(e)})))}function S(e){let{query:t,onChange:l}=e;const{elementType:n,instanceID:a,logQuery:c,logGroup:i}=t;return r().createElement(x,null,r().createElement(C,{label:""},r().createElement(o.InlineField,{label:"Element Type"},r().createElement(o.Input,{value:n,onChange:e=>(e=>{l(Object.assign({},t,{elementType:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Instance ID"},r().createElement(o.Input,{value:a,onChange:e=>(e=>{l(Object.assign({},t,{instanceID:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Log Group"},r().createElement(o.Input,{value:i,onChange:e=>(e=>{l(Object.assign({},t,{logGroup:e.target.value}))})(e)}))),r().createElement(C,{label:""},r().createElement(o.Input,{placeholder:"Enter your log query",value:c,onChange:e=>(e=>{l(Object.assign({},t,{logQuery:e.target.value}))})(e)})))}function w(e){let{query:t,onChange:l}=e;const{elementType:n,instanceID:a,traceQuery:c,traceLocation:i}=t;return r().createElement(x,null,r().createElement(C,{label:""},r().createElement(o.InlineField,{label:"Element Type"},r().createElement(o.Input,{value:n,onChange:e=>(e=>{l(Object.assign({},t,{elementType:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Instance ID"},r().createElement(o.Input,{value:a,onChange:e=>(e=>{l(Object.assign({},t,{instanceID:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Trace Location"},r().createElement(o.Input,{value:i,onChange:e=>(e=>{l(Object.assign({},t,{traceLocation:e.target.value}))})(e)}))),r().createElement(C,{label:""},r().createElement(o.Input,{placeholder:"Enter your trace query",value:c,onChange:e=>(e=>{l(Object.assign({},t,{traceQuery:e.target.value}))})(e)})))}const T=e=>{const t=(0,o.useTheme2)(),l=F(t,e);return r().createElement("span",{className:(0,h.cx)(l.wrapper)})};T.defaultProps={v:0,h:0,layout:"block"};const F=(0,o.stylesFactory)(((e,t)=>{var l,n;return{wrapper:(0,h.css)([{paddingRight:e.spacing(null!==(l=t.h)&&void 0!==l?l:0),paddingBottom:e.spacing(null!==(n=t.v)&&void 0!==n?n:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}}));var N;const R=["label","optional","tooltip","children","promoNode","width","invalid","borderColor","tag","dataTestId","horizontal"];function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},D.apply(this,arguments)}const k=e=>{const{label:t,optional:l,tooltip:n,children:a,promoNode:c,width:i,invalid:s,borderColor:u,tag:d,dataTestId:m,horizontal:p}=e,g=function(e,t){if(null==e)return{};var l,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)l=r[n],t.indexOf(l)>=0||(a[l]=e[l]);return a}(e,R),E=(0,o.useTheme2)(),b=q(E,i,s?"red":u,p),v=(null==g?void 0:g.htmlFor)||(null===o.ReactUtils||void 0===o.ReactUtils?void 0:o.ReactUtils.getChildId(a)),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-field${e?"-"+e:""}-${(m||t).replace(/\ /g,"-")}`.toLowerCase()},y=r().createElement(r().Fragment,null,r().createElement("label",{className:b.label,htmlFor:v,"data-testid":h("label")},t,d&&r().createElement(o.Tag,{name:d,className:b.tag,colorIndex:10}),l&&r().createElement("span",{className:b.optional}," - optional"),c,n&&r().createElement(o.Tooltip,{placement:"top",content:n,theme:"info"},r().createElement(o.Icon,{name:"info-circle",size:"sm",className:b.icon}))),N||(N=r().createElement(T,{v:.5})));return p?r().createElement("div",{className:b.root,"data-testid":h("wrapper")},r().createElement(o.Field,D({className:b.field,label:y},g,{horizontal:!0}),a)):r().createElement("div",{className:b.root,"data-testid":h("wrapper")},r().createElement(o.Field,D({className:b.field,label:y},g),a))},q=(0,o.stylesFactory)((function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transparent",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{root:(0,h.css)({minWidth:e.spacing(null!=t?t:0),paddingInlineStart:"7px",paddingInlineEnd:"5px",borderLeft:`1px solid ${l}`,marginRight:n?"10px":"5px"}),label:(0,h.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium,paddingLeft:"1px",border:n?`1px solid ${l}`:"",padding:n?"5px 10px 5px 0px":"",textAlign:n?"right":"left"}),tag:(0,h.css)({marginLeft:"10px"}),optional:(0,h.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,h.css)({marginBottom:0,marginRight:"0px"}),icon:(0,h.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}}));var M,P,A;function L(e){let{query:t,onChange:l}=e;const{elementType:n,instanceID:c,method:i,columns:s,isObjectInsteadOfArray:u,isDataInColumn:d,rowsRoots:m}=t,[p,g]=r().useState([]),E=(0,a.useRef)(!1);r().useEffect((()=>{!1===E.current&&g(s||[{selector:"",as:"",formatAs:""}]),E.current=!0}),[s]);const b=(e,n,a,r)=>{n[e][a]=r,l(Object.assign({},t,{columns:JSON.parse(JSON.stringify(n))}))},v=(e,t)=>{e.splice(t,1),g(JSON.parse(JSON.stringify(e)))};return r().createElement(x,null,r().createElement(C,{label:""},r().createElement(o.InlineField,{label:"Element Type"},r().createElement(o.Input,{value:n,onChange:e=>(e=>{l(Object.assign({},t,{elementType:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Instance ID"},r().createElement(o.Input,{value:c,onChange:e=>(e=>{l(Object.assign({},t,{instanceID:e.target.value}))})(e)})),r().createElement(o.InlineField,{label:"Method"},r().createElement(o.Input,{value:i,onChange:e=>(e=>{l(Object.assign({},t,{method:e.target.value}))})(e)}))),M||(M=r().createElement(C,{label:""},r().createElement("h5",null,r().createElement("b",null,"Parsing Option and Result Field")))),r().createElement(C,{label:""},r().createElement(k,{label:"Rows/Root - Optional"},r().createElement("textarea",{value:m,onChange:e=>{l(Object.assign({},t,{rowsRoots:e.target.value}))},placeholder:"Rows/Root Selector"}))),P||(P=r().createElement(C,{label:""},r().createElement("label",null,"Rows/Root - Optional"))),(e=>{const t=[];for(let l=0;l<e.length;l++){const n=e[l];t.push(r().createElement(C,{label:"",key:`column-${l}`},r().createElement(o.InlineField,{label:"Selector"},r().createElement(o.Input,{value:n.selector,onChange:t=>b(l,e,"selector",t.target.value)})),r().createElement(o.InlineField,{label:"as"},r().createElement(o.Input,{value:n.as,onChange:t=>b(l,e,"as",t.target.value)})),r().createElement(o.InlineField,{label:"Format as"},r().createElement(o.Input,{value:n.formatAs,onChange:t=>b(l,e,"formatAs",t.target.value)})),e.length>1?r().createElement(o.Button,{onClick:()=>v(e,l),icon:"times"}):r().createElement(r().Fragment,null)))}return t})(p),r().createElement(C,{label:"Column - Optional"},r().createElement(o.Button,{onClick:()=>{p.push({selector:"",as:"",formatAs:""}),g(JSON.parse(JSON.stringify(p)))},icon:"plus-square"},"Column")),A||(A=r().createElement(C,{label:""},r().createElement("label",null,"Advance Options - Optional"))),r().createElement(C,{label:""},r().createElement(o.Checkbox,{value:u,label:"Root returns object instead of array?",onChange:e=>{l(Object.assign({},t,{isObjectInsteadOfArray:e.target.checked}))}})),r().createElement(C,{label:""},r().createElement(o.Checkbox,{value:d,label:"Is data in column format?",onChange:e=>{l(Object.assign({},t,{isDataInColumn:e.target.checked}))}})))}const B=function(e){return fetch(`http://34.199.12.114:6057/api/cloud-element/search?id=${e}`).then((e=>e.json()))};const Q=new e.DataSourcePlugin(n).setConfigEditor((function(e){const{onOptionsChange:t,options:l}=e,{jsonData:n}=l;return r().createElement("div",{className:"gf-form-group"},r().createElement(o.InlineField,{label:"Path",labelWidth:12},r().createElement(o.Input,{onChange:e=>{const n=Object.assign({},l.jsonData,{path:e.target.value});t(Object.assign({},l,{jsonData:n}))},value:n.path||"",placeholder:"json field returned to frontend",width:40})),r().createElement(o.InlineField,{label:"API Endpoint",labelWidth:12},r().createElement(o.Input,{onChange:e=>{const n=Object.assign({},l.jsonData,{apiEndpoint:e.target.value});t(Object.assign({},l,{jsonData:n}))},value:n.apiEndpoint||"",placeholder:"API Endpoint",width:40})))})).setQueryEditor((function(e){let{query:t,onChange:l,onRunQuery:n}=e;const[c,i]=(0,a.useState)(""),b=(0,a.useRef)(!1),v=(0,a.useCallback)(((e,t)=>{B(e).then((n=>{if(n&&n[0]){const a=n[0];t=Object.assign({},t,{elementType:a.elementType,elementId:parseInt(e,10),cloudIdentifierName:a.instanceName,cloudIdentifierId:a.instanceId,type:"appkube-cloudwatch",queryMode:"Metrics",source:"url",productId:1,environmentId:parseInt(e,10),moduleId:2,serviceId:2,serviceType:"java app service",cmdbUrl:"",vaultUrl:"",namespace:"AWS/EC2",metricName:"CPUUtilization",statistic:"Average",matchExact:!0,expression:"",id:"",alias:"",period:"",metricQueryType:0,metricEditorMode:0,sqlExpression:"",accountId:"657907747545",region:""}),l(Object.assign({},t))}}))}),[l]);(0,a.useEffect)((()=>{if(!1===b.current){const e=h("var-elementId",window.location.href);e?(i(e),v(e,t)):alert("Please set 'elementId' variable"),b.current=!0}}),[t,l,v]);const h=(e,t)=>{t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const l=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==l?"":l[1]},y=e=>{l(Object.assign({},t,e))},{sourceType:f,metricType:I,metricEditorMode:C}=t,O=C||p.Builder;return r().createElement("div",null,r().createElement("div",{style:{display:"flex",alignItems:"center"}},r().createElement(o.InlineField,{label:"Source Type"},r().createElement(o.Select,{className:"min-width-12 width-12",value:f,options:g,onChange:e=>(e=>{if(e===s?t.queryType="timeSeriesQuery":e===u&&(t.queryType="logAction"),t.sourceType=e,c)v(c,t);else{const e=h("var-elementId",window.location.href);e?(i(e),v(e,t)):alert("Please set 'elementId' variable")}})(e.value),menuShouldPortal:!0})),f===s?r().createElement(r().Fragment,null,r().createElement(o.InlineField,{label:"Source Type"},r().createElement(o.Select,{className:"min-width-12 width-12",value:I,options:E,onChange:e=>{return n=e.value,void l(Object.assign({},t,{metricType:n}));var n},menuShouldPortal:!0})),r().createElement(o.InlineField,{label:"Element ID"},r().createElement(o.Input,{disabled:!0,value:c})),r().createElement("div",{style:{display:"block",flexGrow:"1"}})):r().createElement(r().Fragment,null)),r().createElement("div",null,f===s?r().createElement(j,{query:t,onChange:y,editorMode:O}):r().createElement(r().Fragment,null),f===u?r().createElement(S,{query:t,onChange:y}):r().createElement(r().Fragment,null),f===d?r().createElement(w,{query:t,onChange:y}):r().createElement(r().Fragment,null),f===m?r().createElement(L,{query:t,onChange:y}):r().createElement(r().Fragment,null)))}))})(),i})()));
//# sourceMappingURL=module.js.map