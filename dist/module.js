define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react"],((e,t,n,l,a)=>(()=>{"use strict";var r=[e=>{e.exports=a},e=>{e.exports=l},t=>{t.exports=e},,e=>{e.exports=t},e=>{e.exports=n}],o={};function c(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return r[e](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{c.r(i),c.d(i,{plugin:()=>Q});var e=c(4),t=c(5);const n=async function(e){return fetch(`http://34.199.12.114:6057/api/cloud-element/search?id=${e}`).then((e=>e.json())).then((e=>e))},l={constant:6.5};class a extends t.DataSourceWithBackend{constructor(e){super(e)}findParam(e,t){t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]}async getCloudElements(e){const t=await n(e);let l={};if(t&&t[0]){const n=t[0];l={elementType:n.elementType,elementId:parseInt(e,10),cloudIdentifierName:n.instanceName,cloudIdentifierId:n.instanceId,environmentId:parseInt(e,10)}}return l}getDefaultQuery(e){return l}query(e){const t=this.findParam("var-elementId",window.location.href);let n={};t&&(n=this.getCloudElements(t));let l=e.targets;for(let e=0;e<l.length;e++)l[e]=Object.assign({},l[e],n);return super.query(e)}}var r=c(0),o=c.n(r),s=c(1);const u="metric",d="log",m="trace",p="api";let g;!function(e){e[e.Builder=0]="Builder",e[e.Code=1]="Code"}(g||(g={}));const E=[{label:"Metric",value:u},{label:"LOG",value:d},{label:"Trace",value:m},{label:"API",value:p}],v=[{label:"INFRA",value:"infra"},{label:"SERVICE",value:"service"}],b=[{label:"Metric 1",value:"Metric 1"},{label:"Metric 2",value:"Metric 2"},{label:"Metric 3",value:"Metric 3"}],h=[{label:"Stastic 1",value:"Stastic 1"},{label:"Stastic 2",value:"Stastic 2"},{label:"Stastic 3",value:"Stastic 3"}];g.Builder,g.Code;var y=c(2);const f=["children"];const I=e=>{let{children:t}=e,n=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,f);const l=(0,s.useStyles2)((0,r.useCallback)((e=>C(e,n)),[n]));return o().createElement("div",{className:l.root},t)},C=(e,t)=>{var n,l,a;return{root:(0,y.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(l=t.wrap)||void 0===l||l?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(a=t.gap)&&void 0!==a?a:2),flexGrow:t.flexGrow})}},O=e=>{let{label:t,collapsible:n,collapsed:l=!0,title:a,dataTestId:c,children:i}=e;const u=(0,s.useStyles2)(x),[d,m]=(0,r.useState)(l),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-row${e?"-"+e:""}-${(c||t).replace(/\ /g,"-")}`.toLowerCase()};return o().createElement("div",{className:u.root,"data-testid":p("wrapper")},n&&o().createElement(o().Fragment,null,o().createElement(s.Button,{icon:d?"angle-down":"angle-right",fill:"text",size:"sm",variant:"secondary",onClick:e=>{m(!d),e.preventDefault()},style:{marginRight:"10px"},"data-testid":p("collapse-"+(d?"hide":"show"))}),o().createElement("span",{onClick:e=>{m(!d),e.preventDefault()},"data-testid":p("title")},o().createElement("b",{className:u.collapseTile},t)),o().createElement("span",{className:u.collapseTileSecondary},a?a():"Options")),d&&o().createElement("div",{style:{display:"flex",marginTop:t&&n?"15px":"0px",marginLeft:"0px"},"data-testid":p("children")},i))},x=e=>({root:(0,y.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)}),collapseTile:(0,y.css)({marginRight:e.spacing(1),color:e.colors.secondary.text}),collapseTileSecondary:(0,y.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.secondary.text}})}),j=e=>{let{children:t}=e;return o().createElement(I,{gap:.5,direction:"column"},t)};function S(e){let{query:t,onChange:n,editorMode:l}=e;const{elementType:a,cloudIdentifierId:r,MetricName:c,statistic:i,metricQuery:u}=t;return o().createElement(j,null,o().createElement(O,{label:""},o().createElement(s.InlineField,{label:"Element Type"},o().createElement(s.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Instance ID"},o().createElement(s.Input,{value:r,onChange:e=>(e=>{n(Object.assign({},t,{cloudIdentifierId:e.target.value}))})(e)}))),l===g.Builder?o().createElement(O,{label:""},o().createElement(s.InlineField,{label:"Metric Name"},o().createElement(s.Select,{className:"min-width-12 width-12",value:c,options:b,onChange:e=>{return l=e.value,void n(Object.assign({},t,{MetricName:l}));var l},menuShouldPortal:!0})),o().createElement(s.InlineField,{label:"Statistic"},o().createElement(s.Select,{className:"min-width-12 width-12",value:i,options:h,onChange:e=>{return l=e.value,void n(Object.assign({},t,{statistic:l}));var l},menuShouldPortal:!0}))):o().createElement(O,{label:""},o().createElement(s.Input,{placeholder:"Enter your query",value:u,onChange:e=>(e=>{n(Object.assign({},t,{metricQuery:e.target.value}))})(e)})))}function w(e){let{query:t,onChange:n}=e;const{elementType:l,instanceID:a,logQuery:r,logGroup:c}=t;return o().createElement(j,null,o().createElement(O,{label:""},o().createElement(s.InlineField,{label:"Element Type"},o().createElement(s.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Instance ID"},o().createElement(s.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Log Group"},o().createElement(s.Input,{value:c,onChange:e=>(e=>{n(Object.assign({},t,{logGroup:e.target.value}))})(e)}))),o().createElement(O,{label:""},o().createElement(s.Input,{placeholder:"Enter your log query",value:r,onChange:e=>(e=>{n(Object.assign({},t,{logQuery:e.target.value}))})(e)})))}function T(e){let{query:t,onChange:n}=e;const{elementType:l,instanceID:a,traceQuery:r,traceLocation:c}=t;return o().createElement(j,null,o().createElement(O,{label:""},o().createElement(s.InlineField,{label:"Element Type"},o().createElement(s.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Instance ID"},o().createElement(s.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Trace Location"},o().createElement(s.Input,{value:c,onChange:e=>(e=>{n(Object.assign({},t,{traceLocation:e.target.value}))})(e)}))),o().createElement(O,{label:""},o().createElement(s.Input,{placeholder:"Enter your trace query",value:r,onChange:e=>(e=>{n(Object.assign({},t,{traceQuery:e.target.value}))})(e)})))}const F=e=>{const t=(0,s.useTheme2)(),n=N(t,e);return o().createElement("span",{className:(0,y.cx)(n.wrapper)})};F.defaultProps={v:0,h:0,layout:"block"};const N=(0,s.stylesFactory)(((e,t)=>{var n,l;return{wrapper:(0,y.css)([{paddingRight:e.spacing(null!==(n=t.h)&&void 0!==n?n:0),paddingBottom:e.spacing(null!==(l=t.v)&&void 0!==l?l:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}}));var R;const D=["label","optional","tooltip","children","promoNode","width","invalid","borderColor","tag","dataTestId","horizontal"];function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},k.apply(this,arguments)}const q=e=>{const{label:t,optional:n,tooltip:l,children:a,promoNode:r,width:c,invalid:i,borderColor:u,tag:d,dataTestId:m,horizontal:p}=e,g=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,D),E=(0,s.useTheme2)(),v=M(E,c,i?"red":u,p),b=(null==g?void 0:g.htmlFor)||(null===s.ReactUtils||void 0===s.ReactUtils?void 0:s.ReactUtils.getChildId(a)),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-field${e?"-"+e:""}-${(m||t).replace(/\ /g,"-")}`.toLowerCase()},y=o().createElement(o().Fragment,null,o().createElement("label",{className:v.label,htmlFor:b,"data-testid":h("label")},t,d&&o().createElement(s.Tag,{name:d,className:v.tag,colorIndex:10}),n&&o().createElement("span",{className:v.optional}," - optional"),r,l&&o().createElement(s.Tooltip,{placement:"top",content:l,theme:"info"},o().createElement(s.Icon,{name:"info-circle",size:"sm",className:v.icon}))),R||(R=o().createElement(F,{v:.5})));return p?o().createElement("div",{className:v.root,"data-testid":h("wrapper")},o().createElement(s.Field,k({className:v.field,label:y},g,{horizontal:!0}),a)):o().createElement("div",{className:v.root,"data-testid":h("wrapper")},o().createElement(s.Field,k({className:v.field,label:y},g),a))},M=(0,s.stylesFactory)((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transparent",l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{root:(0,y.css)({minWidth:e.spacing(null!=t?t:0),paddingInlineStart:"7px",paddingInlineEnd:"5px",borderLeft:`1px solid ${n}`,marginRight:l?"10px":"5px"}),label:(0,y.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium,paddingLeft:"1px",border:l?`1px solid ${n}`:"",padding:l?"5px 10px 5px 0px":"",textAlign:l?"right":"left"}),tag:(0,y.css)({marginLeft:"10px"}),optional:(0,y.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,y.css)({marginBottom:0,marginRight:"0px"}),icon:(0,y.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}}));var P,A,L;function B(e){let{query:t,onChange:n}=e;const{elementType:l,instanceID:a,method:c,columns:i,isObjectInsteadOfArray:u,isDataInColumn:d,rowsRoots:m}=t,[p,g]=o().useState([]),E=(0,r.useRef)(!1);o().useEffect((()=>{!1===E.current&&g(i||[{selector:"",as:"",formatAs:""}]),E.current=!0}),[i]);const v=(e,l,a,r)=>{l[e][a]=r,n(Object.assign({},t,{columns:JSON.parse(JSON.stringify(l))}))},b=(e,t)=>{e.splice(t,1),g(JSON.parse(JSON.stringify(e)))};return o().createElement(j,null,o().createElement(O,{label:""},o().createElement(s.InlineField,{label:"Element Type"},o().createElement(s.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Instance ID"},o().createElement(s.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),o().createElement(s.InlineField,{label:"Method"},o().createElement(s.Input,{value:c,onChange:e=>(e=>{n(Object.assign({},t,{method:e.target.value}))})(e)}))),P||(P=o().createElement(O,{label:""},o().createElement("h5",null,o().createElement("b",null,"Parsing Option and Result Field")))),o().createElement(O,{label:""},o().createElement(q,{label:"Rows/Root - Optional"},o().createElement("textarea",{value:m,onChange:e=>{n(Object.assign({},t,{rowsRoots:e.target.value}))},placeholder:"Rows/Root Selector"}))),A||(A=o().createElement(O,{label:""},o().createElement("label",null,"Rows/Root - Optional"))),(e=>{const t=[];for(let n=0;n<e.length;n++){const l=e[n];t.push(o().createElement(O,{label:"",key:`column-${n}`},o().createElement(s.InlineField,{label:"Selector"},o().createElement(s.Input,{value:l.selector,onChange:t=>v(n,e,"selector",t.target.value)})),o().createElement(s.InlineField,{label:"as"},o().createElement(s.Input,{value:l.as,onChange:t=>v(n,e,"as",t.target.value)})),o().createElement(s.InlineField,{label:"Format as"},o().createElement(s.Input,{value:l.formatAs,onChange:t=>v(n,e,"formatAs",t.target.value)})),e.length>1?o().createElement(s.Button,{onClick:()=>b(e,n),icon:"times"}):o().createElement(o().Fragment,null)))}return t})(p),o().createElement(O,{label:"Column - Optional"},o().createElement(s.Button,{onClick:()=>{p.push({selector:"",as:"",formatAs:""}),g(JSON.parse(JSON.stringify(p)))},icon:"plus-square"},"Column")),L||(L=o().createElement(O,{label:""},o().createElement("label",null,"Advance Options - Optional"))),o().createElement(O,{label:""},o().createElement(s.Checkbox,{value:u,label:"Root returns object instead of array?",onChange:e=>{n(Object.assign({},t,{isObjectInsteadOfArray:e.target.checked}))}})),o().createElement(O,{label:""},o().createElement(s.Checkbox,{value:d,label:"Is data in column format?",onChange:e=>{n(Object.assign({},t,{isDataInColumn:e.target.checked}))}})))}const Q=new e.DataSourcePlugin(a).setConfigEditor((function(e){const{onOptionsChange:t,options:n}=e,{jsonData:l}=n;return o().createElement("div",{className:"gf-form-group"},o().createElement(s.InlineField,{label:"Path",labelWidth:12},o().createElement(s.Input,{onChange:e=>{const l=Object.assign({},n.jsonData,{path:e.target.value});t(Object.assign({},n,{jsonData:l}))},value:l.path||"",placeholder:"json field returned to frontend",width:40})),o().createElement(s.InlineField,{label:"API Endpoint",labelWidth:12},o().createElement(s.Input,{onChange:e=>{const l=Object.assign({},n.jsonData,{apiEndpoint:e.target.value});t(Object.assign({},n,{jsonData:l}))},value:l.apiEndpoint||"",placeholder:"API Endpoint",width:40})))})).setQueryEditor((function(e){let{query:t,onChange:l,onRunQuery:a}=e;const[c,i]=(0,r.useState)(""),b=(0,r.useRef)(!1),h=(0,r.useCallback)(((e,t)=>{n(e).then((n=>{if(n&&n[0]){const a=n[0];t=Object.assign({},t,{elementType:a.elementType,elementId:parseInt(e,10),cloudIdentifierName:a.instanceName,cloudIdentifierId:a.instanceId,type:"appkube-cloudwatch",queryMode:"Metrics",source:"url",productId:1,environmentId:parseInt(e,10),moduleId:2,serviceId:2,serviceType:"java app service",cmdbUrl:"",vaultUrl:"",namespace:"AWS/EC2",metricName:"CPUUtilization",statistic:"Average",matchExact:!0,expression:"",id:"",alias:"",period:"",metricQueryType:0,metricEditorMode:0,sqlExpression:"",accountId:"657907747545",region:""}),l(Object.assign({},t))}}))}),[l]);(0,r.useEffect)((()=>{if(!1===b.current){const e=y("var-elementId",window.location.href);e?(i(e),h(e,t)):alert("Please set 'elementId' variable"),b.current=!0}}),[t,l,h]);const y=(e,t)=>{t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]},f=e=>{l(Object.assign({},t,e))},{sourceType:I,metricType:C,metricEditorMode:O}=t,x=O||g.Builder;return o().createElement("div",null,o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement(s.InlineField,{label:"Source Type"},o().createElement(s.Select,{className:"min-width-12 width-12",value:I,options:E,onChange:e=>(e=>{if(e===u?t.queryType="timeSeriesQuery":e===d&&(t.queryType="logAction"),t.sourceType=e,c)h(c,t);else{const e=y("var-elementId",window.location.href);e?(i(e),h(e,t)):alert("Please set 'elementId' variable")}})(e.value),menuShouldPortal:!0})),I===u?o().createElement(o().Fragment,null,o().createElement(s.InlineField,{label:"Source Type"},o().createElement(s.Select,{className:"min-width-12 width-12",value:C,options:v,onChange:e=>{return n=e.value,void l(Object.assign({},t,{metricType:n}));var n},menuShouldPortal:!0})),o().createElement(s.InlineField,{label:"Element ID"},o().createElement(s.Input,{disabled:!0,value:c})),o().createElement("div",{style:{display:"block",flexGrow:"1"}})):o().createElement(o().Fragment,null)),o().createElement("div",null,I===u?o().createElement(S,{query:t,onChange:f,editorMode:x}):o().createElement(o().Fragment,null),I===d?o().createElement(w,{query:t,onChange:f}):o().createElement(o().Fragment,null),I===m?o().createElement(T,{query:t,onChange:f}):o().createElement(o().Fragment,null),I===p?o().createElement(B,{query:t,onChange:f}):o().createElement(o().Fragment,null)))}))})(),i})()));
//# sourceMappingURL=module.js.map