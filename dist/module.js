define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react","rxjs"],((e,t,n,l,a,r)=>(()=>{"use strict";var o=[e=>{e.exports=a},e=>{e.exports=l},t=>{t.exports=e},,e=>{e.exports=t},e=>{e.exports=n},e=>{e.exports=r}],c={};function i(e){var t=c[e];if(void 0!==t)return t.exports;var n=c[e]={exports:{}};return o[e](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{plugin:()=>z});var e=i(4),t=i(5);const n=function(e){return fetch(`http://34.199.12.114:6057/api/cloud-element/search?id=${e}`).then((e=>e.json()))},l={constant:6.5};var a=i(6);class r extends t.DataSourceWithBackend{constructor(e){super(e)}findParam(e,t){t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]}getCloudElements(e){return(0,a.from)(n(e).then((t=>{let n={};if(t&&t[0]){const l=t[0];n={elementType:l.elementType,elementId:parseInt(e,10),cloudIdentifierName:l.instanceName,cloudIdentifierId:l.instanceId,environmentId:parseInt(e,10)}}return n})))}getDefaultQuery(e){return l}query(e){const t=this.findParam("var-elementId",window.location.href);return t?this.getCloudElements(t).pipe((0,a.mergeMap)((t=>{let n=e.targets;for(let e=0;e<n.length;e++)n[e]=Object.assign({},n[e],t);return super.query(e)}))):super.query(e)}}var o=i(0),c=i.n(o),u=i(1);const d="metric",m="log",p="trace",g="api";let E;!function(e){e[e.Builder=0]="Builder",e[e.Code=1]="Code"}(E||(E={}));const v=[{label:"Metric",value:d},{label:"LOG",value:m},{label:"Trace",value:p},{label:"API",value:g}],b=[{label:"INFRA",value:"infra"},{label:"SERVICE",value:"service"}],h=[{label:"Metric 1",value:"Metric 1"},{label:"Metric 2",value:"Metric 2"},{label:"Metric 3",value:"Metric 3"}],y=[{label:"Stastic 1",value:"Stastic 1"},{label:"Stastic 2",value:"Stastic 2"},{label:"Stastic 3",value:"Stastic 3"}];E.Builder,E.Code;var f=i(2);const I=["children"];const C=e=>{let{children:t}=e,n=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,I);const l=(0,u.useStyles2)((0,o.useCallback)((e=>O(e,n)),[n]));return c().createElement("div",{className:l.root},t)},O=(e,t)=>{var n,l,a;return{root:(0,f.css)({display:"flex",flexDirection:null!==(n=t.direction)&&void 0!==n?n:"row",flexWrap:null===(l=t.wrap)||void 0===l||l?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!==(a=t.gap)&&void 0!==a?a:2),flexGrow:t.flexGrow})}},x=e=>{let{label:t,collapsible:n,collapsed:l=!0,title:a,dataTestId:r,children:i}=e;const s=(0,u.useStyles2)(j),[d,m]=(0,o.useState)(l),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-row${e?"-"+e:""}-${(r||t).replace(/\ /g,"-")}`.toLowerCase()};return c().createElement("div",{className:s.root,"data-testid":p("wrapper")},n&&c().createElement(c().Fragment,null,c().createElement(u.Button,{icon:d?"angle-down":"angle-right",fill:"text",size:"sm",variant:"secondary",onClick:e=>{m(!d),e.preventDefault()},style:{marginRight:"10px"},"data-testid":p("collapse-"+(d?"hide":"show"))}),c().createElement("span",{onClick:e=>{m(!d),e.preventDefault()},"data-testid":p("title")},c().createElement("b",{className:s.collapseTile},t)),c().createElement("span",{className:s.collapseTileSecondary},a?a():"Options")),d&&c().createElement("div",{style:{display:"flex",marginTop:t&&n?"15px":"0px",marginLeft:"0px"},"data-testid":p("children")},i))},j=e=>({root:(0,f.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)}),collapseTile:(0,f.css)({marginRight:e.spacing(1),color:e.colors.secondary.text}),collapseTileSecondary:(0,f.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.secondary.text}})}),S=e=>{let{children:t}=e;return c().createElement(C,{gap:.5,direction:"column"},t)};function w(e){let{query:t,onChange:n,editorMode:l}=e;const{elementType:a,cloudIdentifierId:r,MetricName:o,statistic:i,metricQuery:s}=t;return c().createElement(S,null,c().createElement(x,{label:""},c().createElement(u.InlineField,{label:"Element Type"},c().createElement(u.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Instance ID"},c().createElement(u.Input,{value:r,onChange:e=>(e=>{n(Object.assign({},t,{cloudIdentifierId:e.target.value}))})(e)}))),l===E.Builder?c().createElement(x,{label:""},c().createElement(u.InlineField,{label:"Metric Name"},c().createElement(u.Select,{className:"min-width-12 width-12",value:o,options:h,onChange:e=>{return l=e.value,void n(Object.assign({},t,{MetricName:l}));var l},menuShouldPortal:!0})),c().createElement(u.InlineField,{label:"Statistic"},c().createElement(u.Select,{className:"min-width-12 width-12",value:i,options:y,onChange:e=>{return l=e.value,void n(Object.assign({},t,{statistic:l}));var l},menuShouldPortal:!0}))):c().createElement(x,{label:""},c().createElement(u.Input,{placeholder:"Enter your query",value:s,onChange:e=>(e=>{n(Object.assign({},t,{metricQuery:e.target.value}))})(e)})))}function T(e){let{query:t,onChange:n}=e;const{elementType:l,instanceID:a,logQuery:r,logGroup:o}=t;return c().createElement(S,null,c().createElement(x,{label:""},c().createElement(u.InlineField,{label:"Element Type"},c().createElement(u.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Instance ID"},c().createElement(u.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Log Group"},c().createElement(u.Input,{value:o,onChange:e=>(e=>{n(Object.assign({},t,{logGroup:e.target.value}))})(e)}))),c().createElement(x,{label:""},c().createElement(u.Input,{placeholder:"Enter your log query",value:r,onChange:e=>(e=>{n(Object.assign({},t,{logQuery:e.target.value}))})(e)})))}function F(e){let{query:t,onChange:n}=e;const{elementType:l,instanceID:a,traceQuery:r,traceLocation:o}=t;return c().createElement(S,null,c().createElement(x,{label:""},c().createElement(u.InlineField,{label:"Element Type"},c().createElement(u.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Instance ID"},c().createElement(u.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Trace Location"},c().createElement(u.Input,{value:o,onChange:e=>(e=>{n(Object.assign({},t,{traceLocation:e.target.value}))})(e)}))),c().createElement(x,{label:""},c().createElement(u.Input,{placeholder:"Enter your trace query",value:r,onChange:e=>(e=>{n(Object.assign({},t,{traceQuery:e.target.value}))})(e)})))}const N=e=>{const t=(0,u.useTheme2)(),n=R(t,e);return c().createElement("span",{className:(0,f.cx)(n.wrapper)})};N.defaultProps={v:0,h:0,layout:"block"};const R=(0,u.stylesFactory)(((e,t)=>{var n,l;return{wrapper:(0,f.css)([{paddingRight:e.spacing(null!==(n=t.h)&&void 0!==n?n:0),paddingBottom:e.spacing(null!==(l=t.v)&&void 0!==l?l:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}}));var D;const k=["label","optional","tooltip","children","promoNode","width","invalid","borderColor","tag","dataTestId","horizontal"];function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},q.apply(this,arguments)}const M=e=>{const{label:t,optional:n,tooltip:l,children:a,promoNode:r,width:o,invalid:i,borderColor:s,tag:d,dataTestId:m,horizontal:p}=e,g=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,k),E=(0,u.useTheme2)(),v=P(E,o,i?"red":s,p),b=(null==g?void 0:g.htmlFor)||(null===u.ReactUtils||void 0===u.ReactUtils?void 0:u.ReactUtils.getChildId(a)),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`infinity-query-field${e?"-"+e:""}-${(m||t).replace(/\ /g,"-")}`.toLowerCase()},y=c().createElement(c().Fragment,null,c().createElement("label",{className:v.label,htmlFor:b,"data-testid":h("label")},t,d&&c().createElement(u.Tag,{name:d,className:v.tag,colorIndex:10}),n&&c().createElement("span",{className:v.optional}," - optional"),r,l&&c().createElement(u.Tooltip,{placement:"top",content:l,theme:"info"},c().createElement(u.Icon,{name:"info-circle",size:"sm",className:v.icon}))),D||(D=c().createElement(N,{v:.5})));return p?c().createElement("div",{className:v.root,"data-testid":h("wrapper")},c().createElement(u.Field,q({className:v.field,label:y},g,{horizontal:!0}),a)):c().createElement("div",{className:v.root,"data-testid":h("wrapper")},c().createElement(u.Field,q({className:v.field,label:y},g),a))},P=(0,u.stylesFactory)((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transparent",l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{root:(0,f.css)({minWidth:e.spacing(null!=t?t:0),paddingInlineStart:"7px",paddingInlineEnd:"5px",borderLeft:`1px solid ${n}`,marginRight:l?"10px":"5px"}),label:(0,f.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium,paddingLeft:"1px",border:l?`1px solid ${n}`:"",padding:l?"5px 10px 5px 0px":"",textAlign:l?"right":"left"}),tag:(0,f.css)({marginLeft:"10px"}),optional:(0,f.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,f.css)({marginBottom:0,marginRight:"0px"}),icon:(0,f.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}}));var A,L,B;function Q(e){let{query:t,onChange:n}=e;const{elementType:l,instanceID:a,method:r,columns:i,isObjectInsteadOfArray:s,isDataInColumn:d,rowsRoots:m}=t,[p,g]=c().useState([]),E=(0,o.useRef)(!1);c().useEffect((()=>{!1===E.current&&g(i||[{selector:"",as:"",formatAs:""}]),E.current=!0}),[i]);const v=(e,l,a,r)=>{l[e][a]=r,n(Object.assign({},t,{columns:JSON.parse(JSON.stringify(l))}))},b=(e,t)=>{e.splice(t,1),g(JSON.parse(JSON.stringify(e)))};return c().createElement(S,null,c().createElement(x,{label:""},c().createElement(u.InlineField,{label:"Element Type"},c().createElement(u.Input,{value:l,onChange:e=>(e=>{n(Object.assign({},t,{elementType:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Instance ID"},c().createElement(u.Input,{value:a,onChange:e=>(e=>{n(Object.assign({},t,{instanceID:e.target.value}))})(e)})),c().createElement(u.InlineField,{label:"Method"},c().createElement(u.Input,{value:r,onChange:e=>(e=>{n(Object.assign({},t,{method:e.target.value}))})(e)}))),A||(A=c().createElement(x,{label:""},c().createElement("h5",null,c().createElement("b",null,"Parsing Option and Result Field")))),c().createElement(x,{label:""},c().createElement(M,{label:"Rows/Root - Optional"},c().createElement("textarea",{value:m,onChange:e=>{n(Object.assign({},t,{rowsRoots:e.target.value}))},placeholder:"Rows/Root Selector"}))),L||(L=c().createElement(x,{label:""},c().createElement("label",null,"Rows/Root - Optional"))),(e=>{const t=[];for(let n=0;n<e.length;n++){const l=e[n];t.push(c().createElement(x,{label:"",key:`column-${n}`},c().createElement(u.InlineField,{label:"Selector"},c().createElement(u.Input,{value:l.selector,onChange:t=>v(n,e,"selector",t.target.value)})),c().createElement(u.InlineField,{label:"as"},c().createElement(u.Input,{value:l.as,onChange:t=>v(n,e,"as",t.target.value)})),c().createElement(u.InlineField,{label:"Format as"},c().createElement(u.Input,{value:l.formatAs,onChange:t=>v(n,e,"formatAs",t.target.value)})),e.length>1?c().createElement(u.Button,{onClick:()=>b(e,n),icon:"times"}):c().createElement(c().Fragment,null)))}return t})(p),c().createElement(x,{label:"Column - Optional"},c().createElement(u.Button,{onClick:()=>{p.push({selector:"",as:"",formatAs:""}),g(JSON.parse(JSON.stringify(p)))},icon:"plus-square"},"Column")),B||(B=c().createElement(x,{label:""},c().createElement("label",null,"Advance Options - Optional"))),c().createElement(x,{label:""},c().createElement(u.Checkbox,{value:s,label:"Root returns object instead of array?",onChange:e=>{n(Object.assign({},t,{isObjectInsteadOfArray:e.target.checked}))}})),c().createElement(x,{label:""},c().createElement(u.Checkbox,{value:d,label:"Is data in column format?",onChange:e=>{n(Object.assign({},t,{isDataInColumn:e.target.checked}))}})))}const z=new e.DataSourcePlugin(r).setConfigEditor((function(e){const{onOptionsChange:t,options:n}=e,{jsonData:l}=n;return c().createElement("div",{className:"gf-form-group"},c().createElement(u.InlineField,{label:"Path",labelWidth:12},c().createElement(u.Input,{onChange:e=>{const l=Object.assign({},n.jsonData,{path:e.target.value});t(Object.assign({},n,{jsonData:l}))},value:l.path||"",placeholder:"json field returned to frontend",width:40})),c().createElement(u.InlineField,{label:"API Endpoint",labelWidth:12},c().createElement(u.Input,{onChange:e=>{const l=Object.assign({},n.jsonData,{apiEndpoint:e.target.value});t(Object.assign({},n,{jsonData:l}))},value:l.apiEndpoint||"",placeholder:"API Endpoint",width:40})))})).setQueryEditor((function(e){let{query:t,onChange:l,onRunQuery:a}=e;const[r,i]=(0,o.useState)(""),s=(0,o.useRef)(!1),h=(0,o.useCallback)(((e,t)=>{n(e).then((n=>{if(n&&n[0]){const a=n[0];t=Object.assign({},t,{elementType:a.elementType,elementId:parseInt(e,10),cloudIdentifierName:a.instanceName,cloudIdentifierId:a.instanceId,type:"appkube-cloudwatch",queryMode:"Metrics",source:"url",productId:1,environmentId:parseInt(e,10),moduleId:2,serviceId:2,serviceType:"java app service",cmdbUrl:"",vaultUrl:"",namespace:"AWS/EC2",metricName:"CPUUtilization",statistic:"Average",matchExact:!0,expression:"",id:"",alias:"",period:"",metricQueryType:0,metricEditorMode:0,sqlExpression:"",accountId:"657907747545",region:""}),l(Object.assign({},t))}}))}),[l]);(0,o.useEffect)((()=>{if(!1===s.current){const e=y("var-elementId",window.location.href);e?(i(e),h(e,t)):alert("Please set 'elementId' variable"),s.current=!0}}),[t,l,h]);const y=(e,t)=>{t||(t=location.href),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n?"":n[1]},f=e=>{l(Object.assign({},t,e))},{sourceType:I,metricType:C,metricEditorMode:O}=t,x=O||E.Builder;return c().createElement("div",null,c().createElement("div",{style:{display:"flex",alignItems:"center"}},c().createElement(u.InlineField,{label:"Source Type"},c().createElement(u.Select,{className:"min-width-12 width-12",value:I,options:v,onChange:e=>(e=>{if(e===d?t.queryType="timeSeriesQuery":e===m&&(t.queryType="logAction"),t.sourceType=e,r)h(r,t);else{const e=y("var-elementId",window.location.href);e?(i(e),h(e,t)):alert("Please set 'elementId' variable")}})(e.value),menuShouldPortal:!0})),I===d?c().createElement(c().Fragment,null,c().createElement(u.InlineField,{label:"Source Type"},c().createElement(u.Select,{className:"min-width-12 width-12",value:C,options:b,onChange:e=>{return n=e.value,void l(Object.assign({},t,{metricType:n}));var n},menuShouldPortal:!0})),c().createElement(u.InlineField,{label:"Element ID"},c().createElement(u.Input,{disabled:!0,value:r})),c().createElement("div",{style:{display:"block",flexGrow:"1"}})):c().createElement(c().Fragment,null)),c().createElement("div",null,I===d?c().createElement(w,{query:t,onChange:f,editorMode:x}):c().createElement(c().Fragment,null),I===m?c().createElement(T,{query:t,onChange:f}):c().createElement(c().Fragment,null),I===p?c().createElement(F,{query:t,onChange:f}):c().createElement(c().Fragment,null),I===g?c().createElement(Q,{query:t,onChange:f}):c().createElement(c().Fragment,null)))}))})(),s})()));
//# sourceMappingURL=module.js.map